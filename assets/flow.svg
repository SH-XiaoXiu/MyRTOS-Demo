<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 750" font-family="Arial, 'Microsoft YaHei', sans-serif">
  <!-- 白色背景 -->
  <rect x="0" y="0" width="900" height="750" fill="white"/>

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- 标题 -->
  <text x="450" y="28" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">MyRTOS 启动与调度流程</text>

  <!-- ========== 启动阶段 (左栏) ========== -->
  <text x="220" y="58" text-anchor="middle" font-size="14" font-weight="bold" fill="#004085">启动阶段</text>

  <!-- main() -->
  <rect x="120" y="70" width="200" height="40" rx="20" fill="#cce5ff" stroke="#007bff" stroke-width="1.5"/>
  <text x="220" y="96" text-anchor="middle" font-size="13" font-weight="bold" fill="#004085">main()</text>

  <line x1="220" y1="110" x2="220" y2="130" stroke="#666" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- platform_init() -->
  <rect x="120" y="135" width="200" height="35" rx="4" fill="#cce5ff" stroke="#007bff" stroke-width="1"/>
  <text x="220" y="158" text-anchor="middle" font-size="12" fill="#333">platform_init() 平台初始化</text>

  <line x1="220" y1="170" x2="220" y2="190" stroke="#666" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- MyRTOS_Boot_Init() -->
  <rect x="70" y="195" width="300" height="175" rx="4" fill="none" stroke="#6f42c1" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="220" y="218" text-anchor="middle" font-size="13" font-weight="bold" fill="#4a2c7a">MyRTOS_Boot_Init()</text>

  <!-- 子项 -->
  <rect x="90" y="228" width="260" height="30" rx="3" fill="#e2d5f1" stroke="#6f42c1" stroke-width="1"/>
  <text x="220" y="249" text-anchor="middle" font-size="11" fill="#333">boot_print_banner() 打印横幅</text>

  <rect x="90" y="263" width="260" height="30" rx="3" fill="#e2d5f1" stroke="#6f42c1" stroke-width="1"/>
  <text x="220" y="284" text-anchor="middle" font-size="11" fill="#333">MyRTOS_Init() 内核初始化</text>

  <rect x="90" y="298" width="260" height="30" rx="3" fill="#e2d5f1" stroke="#6f42c1" stroke-width="1"/>
  <text x="220" y="319" text-anchor="middle" font-size="11" fill="#333">on_kernel_init() 用户回调</text>

  <rect x="90" y="333" width="260" height="30" rx="3" fill="#fff3cd" stroke="#ffc107" stroke-width="1"/>
  <text x="220" y="354" text-anchor="middle" font-size="11" fill="#333">boot_init_services() 初始化服务</text>

  <line x1="220" y1="370" x2="220" y2="395" stroke="#666" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- MyRTOS_Boot_Start() -->
  <rect x="70" y="400" width="300" height="115" rx="4" fill="none" stroke="#28a745" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="220" y="423" text-anchor="middle" font-size="13" font-weight="bold" fill="#155724">MyRTOS_Boot_Start()</text>

  <rect x="90" y="433" width="260" height="30" rx="3" fill="#d4edda" stroke="#28a745" stroke-width="1"/>
  <text x="220" y="454" text-anchor="middle" font-size="11" fill="#333">create_tasks() 创建用户任务</text>

  <rect x="90" y="468" width="260" height="30" rx="3" fill="#d4edda" stroke="#28a745" stroke-width="1"/>
  <text x="220" y="489" text-anchor="middle" font-size="11" fill="#333">Task_StartScheduler() 启动调度</text>

  <line x1="220" y1="515" x2="220" y2="540" stroke="#666" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- 调度器运行 -->
  <rect x="120" y="545" width="200" height="38" rx="19" fill="#28a745" stroke="#1e7e34" stroke-width="1.5"/>
  <text x="220" y="570" text-anchor="middle" font-size="12" fill="white" font-weight="bold">调度器运行中</text>

  <!-- ========== 运行时调度 (右栏) ========== -->
  <text x="650" y="58" text-anchor="middle" font-size="14" font-weight="bold" fill="#721c24">运行时调度</text>

  <!-- SysTick 中断 -->
  <rect x="500" y="70" width="300" height="130" rx="4" fill="#fff" stroke="#dc3545" stroke-width="1.5"/>
  <text x="650" y="93" text-anchor="middle" font-size="13" font-weight="bold" fill="#721c24">SysTick Handler (系统节拍)</text>

  <rect x="520" y="103" width="260" height="28" rx="3" fill="#f8d7da" stroke="#dc3545" stroke-width="1"/>
  <text x="650" y="123" text-anchor="middle" font-size="11" fill="#333">MyRTOS_Tick_Handler()</text>

  <rect x="520" y="136" width="260" height="28" rx="3" fill="#f8d7da" stroke="#dc3545" stroke-width="1"/>
  <text x="650" y="156" text-anchor="middle" font-size="11" fill="#333">更新 tick 计数器</text>

  <rect x="520" y="169" width="260" height="28" rx="3" fill="#f8d7da" stroke="#dc3545" stroke-width="1"/>
  <text x="650" y="189" text-anchor="middle" font-size="11" fill="#333">唤醒延时任务 -&gt; 触发 PendSV</text>

  <!-- PendSV -->
  <line x1="650" y1="200" x2="650" y2="230" stroke="#666" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <rect x="500" y="235" width="300" height="130" rx="4" fill="#fff" stroke="#e91e63" stroke-width="1.5"/>
  <text x="650" y="258" text-anchor="middle" font-size="13" font-weight="bold" fill="#880e4f">PendSV Handler (上下文切换)</text>

  <rect x="520" y="268" width="260" height="28" rx="3" fill="#fce4ec" stroke="#e91e63" stroke-width="1"/>
  <text x="650" y="288" text-anchor="middle" font-size="11" fill="#333">保存当前任务上下文</text>

  <rect x="520" y="301" width="260" height="28" rx="3" fill="#fce4ec" stroke="#e91e63" stroke-width="1"/>
  <text x="650" y="321" text-anchor="middle" font-size="11" fill="#333">MyRTOS_Schedule() 选择下一任务</text>

  <rect x="520" y="334" width="260" height="28" rx="3" fill="#fce4ec" stroke="#e91e63" stroke-width="1"/>
  <text x="650" y="354" text-anchor="middle" font-size="11" fill="#333">恢复下一任务上下文</text>

  <!-- 核心数据结构 -->
  <text x="650" y="395" text-anchor="middle" font-size="14" font-weight="bold" fill="#555">核心数据结构</text>

  <rect x="500" y="408" width="300" height="175" rx="4" fill="#f8f9fa" stroke="#adb5bd" stroke-width="1"/>

  <text x="520" y="435" font-size="12" font-weight="bold" fill="#333">readyTaskLists[priority]</text>
  <text x="530" y="455" font-size="11" fill="#666">按优先级分组的就绪任务列表</text>

  <text x="520" y="482" font-size="12" font-weight="bold" fill="#333">delayedTaskListHead</text>
  <text x="530" y="502" font-size="11" fill="#666">按唤醒时间排序的延时任务链表</text>

  <text x="520" y="529" font-size="12" font-weight="bold" fill="#333">currentTask</text>
  <text x="530" y="549" font-size="11" fill="#666">当前正在执行的任务</text>

  <text x="520" y="576" font-size="12" font-weight="bold" fill="#333">topReadyPriority</text>
  <text x="530" y="596" font-size="11" fill="#666">当前最高就绪优先级</text>

  <!-- 连接线 -->
  <path d="M370 565 Q430 480 500 145" stroke="#aaa" stroke-width="1.5" stroke-dasharray="4,4" fill="none" marker-end="url(#arrowhead)"/>
  <text x="430" y="380" font-size="10" fill="#888" transform="rotate(-55, 430, 380)">触发</text>

  <!-- 已初始化服务 -->
  <rect x="500" y="620" width="300" height="100" rx="4" fill="#fff3cd" stroke="#ffc107" stroke-width="1.5"/>
  <text x="650" y="648" text-anchor="middle" font-size="13" font-weight="bold" fill="#856404">已初始化服务</text>
  <text x="520" y="672" font-size="11" fill="#555">IO  |  AsyncIO  |  Log  |  Timer</text>
  <text x="520" y="690" font-size="11" fill="#555">Monitor  |  Process  |  VTS</text>
  <text x="520" y="708" font-size="10" fill="#888">(由 MyRTOS_Service_Config.h 配置)</text>

  <!-- 图例 -->
  <rect x="50" y="610" width="320" height="110" rx="4" fill="#f8f9fa" stroke="#dee2e6"/>
  <text x="210" y="632" text-anchor="middle" font-size="12" font-weight="bold" fill="#555">图例</text>

  <rect x="70" y="648" width="40" height="16" rx="2" fill="#cce5ff" stroke="#007bff"/>
  <text x="120" y="661" font-size="11" fill="#333">平台/初始化</text>

  <rect x="200" y="648" width="40" height="16" rx="2" fill="#e2d5f1" stroke="#6f42c1"/>
  <text x="250" y="661" font-size="11" fill="#333">启动模块</text>

  <rect x="70" y="673" width="40" height="16" rx="2" fill="#d4edda" stroke="#28a745"/>
  <text x="120" y="686" font-size="11" fill="#333">调度器</text>

  <rect x="200" y="673" width="40" height="16" rx="2" fill="#f8d7da" stroke="#dc3545"/>
  <text x="250" y="686" font-size="11" fill="#333">中断处理</text>

  <rect x="70" y="698" width="40" height="16" rx="2" fill="#fff3cd" stroke="#ffc107"/>
  <text x="120" y="711" font-size="11" fill="#333">服务层</text>
</svg>
